import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:gonggoo_app/core/config/app_config.dart';
import 'package:gonggoo_app/features/auth/models/user_model.dart';
import '../../../core/theme/index.dart';
import '../../../core/widgets/loading_modal.dart';
import '../../auth/providers/auth_state.dart';
import '../../auth/screens/login_screen.dart';
import '../../../features/products/screens/product_list_screen.dart';

import '../../../features/cart/screens/cart_screen.dart';
import '../../order/providers/order_history_state.dart';
import '../../order/models/order_model.dart';
import '../../order/models/order_enums.dart';

import '../../order/widgets/order_history_item.dart';

class HomeScreen extends StatefulWidget {
  static const routeName = '/home';

  const HomeScreen({super.key});

  @override
  _HomeScreenState createState() => _HomeScreenState();
}

class _HomeScreenState extends State<HomeScreen> {
  int _selectedIndex = 0;

  final List<Widget> _pages = [
    const ProductListScreen(),
    const CartScreen(),
    const _ProfileContent(),
  ];

  void _onItemTapped(int index) {
    setState(() {
      _selectedIndex = index;
    });

    // ÌîÑÎ°úÌïÑ ÌÉ≠ ÏÑ†ÌÉù Ïãú Ï£ºÎ¨∏ ÎÇ¥Ïó≠ ÏÉàÎ°úÍ≥†Ïπ®
    if (index == 2) {
      // PostFrameCallbackÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ ÏúÑÏ†ØÏù¥ ÎπåÎìúÎêú ÌõÑ Ïã§Ìñâ
      WidgetsBinding.instance.addPostFrameCallback((_) {
        if (mounted) {
          final container = ProviderScope.containerOf(context);
          container.read(orderHistoryProvider.notifier).refreshOrders();
        }
      });
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: IndexedStack(
        index: _selectedIndex,
        children: _pages,
      ),
      bottomNavigationBar: BottomNavigationBar(
        type: BottomNavigationBarType.fixed,
        currentIndex: _selectedIndex,
        onTap: _onItemTapped,
        selectedItemColor: ColorPalette.primary,
        unselectedItemColor: Theme.of(context).brightness == Brightness.dark
            ? ColorPalette.textSecondaryDark
            : ColorPalette.textSecondaryLight,
        items: const [
          BottomNavigationBarItem(
            icon: Icon(Icons.home_outlined),
            activeIcon: Icon(Icons.home),
            label: 'Ìôà',
          ),
          BottomNavigationBarItem(
            icon: Icon(Icons.shopping_cart_outlined),
            activeIcon: Icon(Icons.shopping_cart),
            label: 'Ïû•Î∞îÍµ¨Îãà',
          ),
          BottomNavigationBarItem(
            icon: Icon(Icons.person_outline),
            activeIcon: Icon(Icons.person),
            label: 'ÎÇ¥Ï†ïÎ≥¥',
          ),
        ],
      ),
      floatingActionButton: null,
    );
  }
}

void _onNavigateToProducts(BuildContext context) {
  final homeScreenState = context.findAncestorStateOfType<_HomeScreenState>();
  if (homeScreenState != null) {
    homeScreenState._onItemTapped(0); // Navigate to products tab
  }
}

Widget _buildCategoryCard(
  BuildContext context,
  String title,
  IconData icon,
  VoidCallback onTap,
) {
  final isDarkMode = Theme.of(context).brightness == Brightness.dark;

  return GestureDetector(
    onTap: onTap,
    child: Container(
      width: 100,
      margin: const EdgeInsets.only(right: Dimensions.spacingSm),
      padding: const EdgeInsets.all(Dimensions.paddingSm),
      decoration: BoxDecoration(
        color:
            isDarkMode ? ColorPalette.surfaceDark : ColorPalette.surfaceLight,
        borderRadius: BorderRadius.circular(Dimensions.radiusSm),
        boxShadow: isDarkMode ? null : Styles.shadowXs,
      ),
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Icon(
            icon,
            color: ColorPalette.primary,
            size: 32,
          ),
          const SizedBox(height: Dimensions.spacingXs),
          Text(
            title,
            style: TextStyles.bodySmall.copyWith(
              color: isDarkMode
                  ? ColorPalette.textPrimaryDark
                  : ColorPalette.textPrimaryLight,
            ),
            textAlign: TextAlign.center,
          ),
        ],
      ),
    ),
  );
}

// Profile content
class _ProfileContent extends ConsumerWidget {
  const _ProfileContent({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final authState = ref.watch(authProvider);
    final isDarkMode = Theme.of(context).brightness == Brightness.dark;

    return authState.when(
      data: (state) {
        final user = state.user;

        // ÌòÑÏû¨ ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÎîîÎ≤ÑÍπÖ
        debugPrint('üë§ ÌòÑÏû¨ Î°úÍ∑∏Ïù∏ ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥:');
        debugPrint('üë§ user: $user');
        debugPrint('üë§ user?.uid: ${user?.uid}');
        debugPrint('üë§ user?.name: ${user?.name}');
        debugPrint('üë§ user?.phoneNumber: ${user?.phoneNumber}');

        return Scaffold(
          appBar: AppBar(
            title: const Text('ÎÇ¥ Ï†ïÎ≥¥'),
            centerTitle: true,
            elevation: 0,
            actions: [
              IconButton(
                icon: const Icon(Icons.logout),
                onPressed: () => _showLogoutDialog(context, ref),
              ),
            ],
          ),
          body: SafeArea(
            child: SingleChildScrollView(
              padding: const EdgeInsets.all(Dimensions.padding),
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  // User profile header
                  Row(
                    children: [
                      CircleAvatar(
                        backgroundColor: ColorPalette.primary,
                        radius: 40,
                        child: Text(
                          (user?.name ?? '?').substring(0, 1),
                          style: TextStyles.headlineMedium.copyWith(
                            color: Colors.white,
                          ),
                        ),
                      ),
                      const SizedBox(width: Dimensions.spacingMd),
                      Expanded(
                        child: Column(
                          crossAxisAlignment: CrossAxisAlignment.start,
                          children: [
                            Text(
                              user?.name ?? 'ÏÇ¨Ïö©Ïûê',
                              style: TextStyles.titleLarge.copyWith(
                                color: isDarkMode
                                    ? ColorPalette.textPrimaryDark
                                    : ColorPalette.textPrimaryLight,
                              ),
                            ),
                            Text(
                              user?.phoneNumber ?? 'Ï†ÑÌôîÎ≤àÌò∏ ÏóÜÏùå',
                              style: TextStyles.bodyMedium.copyWith(
                                color: Colors.grey[600],
                              ),
                            ),
                          ],
                        ),
                      ),
                      SizedBox(
                        width: 80,
                        child: OutlinedButton.icon(
                          onPressed: () {
                            Navigator.of(context).pushNamed('/edit-profile');
                          },
                          icon: const Icon(Icons.edit, size: 16),
                          label: const Text('ÏàòÏ†ï'),
                          style: OutlinedButton.styleFrom(
                            foregroundColor: ColorPalette.primary,
                            side: const BorderSide(color: ColorPalette.primary),
                            padding: const EdgeInsets.symmetric(
                              horizontal: Dimensions.paddingXs,
                              vertical: 4,
                            ),
                          ),
                        ),
                      ),
                    ],
                  ),

                  const SizedBox(height: Dimensions.spacingLg),

                  // User info card
                  Container(
                    padding: const EdgeInsets.all(Dimensions.padding),
                    decoration: BoxDecoration(
                      color: isDarkMode
                          ? ColorPalette.surfaceDark
                          : ColorPalette.surfaceLight,
                      borderRadius: BorderRadius.circular(Dimensions.radius),
                      boxShadow: isDarkMode ? null : Styles.shadowSm,
                    ),
                    child: Column(
                      crossAxisAlignment: CrossAxisAlignment.start,
                      children: [
                        Text(
                          'ÎÇ¥ Ï†ïÎ≥¥',
                          style: TextStyles.titleLarge.copyWith(
                            color: isDarkMode
                                ? ColorPalette.textPrimaryDark
                                : ColorPalette.textPrimaryLight,
                          ),
                        ),
                        const Divider(),
                        const SizedBox(height: Dimensions.spacingSm),
                        _buildInfoRow(
                          context,
                          'Ïù¥Î¶Ñ',
                          user?.name ?? 'N/A',
                          isDarkMode,
                        ),
                        const SizedBox(height: Dimensions.spacingSm),
                        _buildInfoRow(
                          context,
                          'Ï†ÑÌôîÎ≤àÌò∏',
                          user?.phoneNumber ?? 'Îì±Î°ùÎêú Ï†ÑÌôîÎ≤àÌò∏Í∞Ä ÏóÜÏäµÎãàÎã§',
                          isDarkMode,
                        ),
                        const SizedBox(height: Dimensions.spacingSm),
                        _buildInfoRow(
                          context,
                          'Ï£ºÏÜå',
                          _formatAddress(user),
                          isDarkMode,
                        ),
                      ],
                    ),
                  ),

                  // Profile completion reminder if needed
                  if (user?.roadNameAddress == null) ...[
                    const SizedBox(height: Dimensions.spacingLg),
                    Container(
                      padding: const EdgeInsets.all(Dimensions.paddingSm),
                      decoration: BoxDecoration(
                        color: ColorPalette.warning.withOpacity(0.1),
                        borderRadius:
                            BorderRadius.circular(Dimensions.radiusSm),
                        border: Border.all(
                          color: ColorPalette.warning.withOpacity(0.3),
                          width: 1,
                        ),
                      ),
                      child: Column(
                        children: [
                          Row(
                            children: [
                              const Icon(
                                Icons.warning_amber_rounded,
                                color: ColorPalette.warning,
                              ),
                              const SizedBox(width: Dimensions.spacingSm),
                              Expanded(
                                child: Text(
                                  'ÌîÑÎ°úÌïÑÏùÑ ÏôÑÏÑ±ÌïòÏó¨ ÏôÄÏπòÎß®ÏùÑ Îçî Ìé∏Î¶¨ÌïòÍ≤å Ïù¥Ïö©Ìï¥Î≥¥ÏÑ∏Ïöî!',
                                  style: TextStyles.bodyMedium.copyWith(
                                    color: isDarkMode
                                        ? ColorPalette.textPrimaryDark
                                        : ColorPalette.textPrimaryLight,
                                    fontWeight: FontWeight.w600,
                                  ),
                                ),
                              ),
                            ],
                          ),
                          const SizedBox(height: Dimensions.spacingSm),
                          Text(
                            'ÏÑúÎπÑÏä§Ïùò Î™®Îì† Í∏∞Îä•ÏùÑ ÏÇ¨Ïö©ÌïòÍ∏∞ ÏúÑÌï¥ÏÑúÎäî Ï£ºÏÜå Ï†ïÎ≥¥Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§.',
                            style: TextStyles.bodySmall.copyWith(
                              color: isDarkMode
                                  ? ColorPalette.textSecondaryDark
                                  : ColorPalette.textSecondaryLight,
                            ),
                          ),
                          const SizedBox(height: Dimensions.spacingSm),
                          ElevatedButton(
                            onPressed: () {
                              Navigator.of(context).pushNamed('/edit-profile');
                            },
                            style: ElevatedButton.styleFrom(
                              backgroundColor: ColorPalette.warning,
                              foregroundColor: Colors.white,
                            ),
                            child: const Text('ÌîÑÎ°úÌïÑ ÏôÑÏÑ±ÌïòÍ∏∞'),
                          ),
                        ],
                      ),
                    ),
                  ],

                  // ÏµúÍ∑º Ï£ºÎ¨∏ ÎÇ¥Ïó≠ ÏÑπÏÖò Ï∂îÍ∞Ä
                  const SizedBox(height: Dimensions.spacingLg),
                  _RecentOrdersSection(isDarkMode: isDarkMode),
                ],
              ),
            ),
          ),
        );
      },
      loading: () => const Scaffold(
        body: Center(
          child: CircularProgressIndicator(),
        ),
      ),
      error: (error, stackTrace) => Scaffold(
        body: Center(
          child: Text('Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: $error'),
        ),
      ),
    );
  }

  Widget _buildInfoRow(
    BuildContext context,
    String label,
    String value,
    bool isDarkMode,
  ) {
    return Row(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        SizedBox(
          width: 80,
          child: Text(
            label,
            style: TextStyles.bodyMedium.copyWith(
              color: isDarkMode
                  ? ColorPalette.textSecondaryDark
                  : ColorPalette.textSecondaryLight,
              fontWeight: FontWeight.w600,
            ),
          ),
        ),
        const SizedBox(width: Dimensions.spacingSm),
        Expanded(
          child: Text(
            value,
            style: TextStyles.bodyMedium.copyWith(
              color: isDarkMode
                  ? ColorPalette.textPrimaryDark
                  : ColorPalette.textPrimaryLight,
            ),
          ),
        ),
      ],
    );
  }

  String _formatAddress(UserModel? user) {
    if (user == null || user.roadNameAddress == null) {
      return 'Îì±Î°ùÎêú Ï£ºÏÜåÍ∞Ä ÏóÜÏäµÎãàÎã§';
    }

    String address = user.roadNameAddress!;
    if (user.detailedAddress != null && user.detailedAddress!.isNotEmpty) {
      address += '\n${user.detailedAddress}';
    }

    return address;
  }

  Future<void> _showLogoutDialog(BuildContext context, WidgetRef ref) async {
    final isDarkMode = Theme.of(context).brightness == Brightness.dark;

    return showDialog<void>(
      context: context,
      barrierDismissible: false,
      builder: (BuildContext context) {
        return AlertDialog(
          title: Text(
            'Î°úÍ∑∏ÏïÑÏõÉ',
            style: TextStyles.titleLarge.copyWith(
              color: isDarkMode
                  ? ColorPalette.textPrimaryDark
                  : ColorPalette.textPrimaryLight,
            ),
          ),
          content: Text(
            'Ï†ïÎßê Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?',
            style: TextStyles.bodyMedium.copyWith(
              color: isDarkMode
                  ? ColorPalette.textPrimaryDark
                  : ColorPalette.textPrimaryLight,
            ),
          ),
          actions: <Widget>[
            TextButton(
              child: Text(
                'Ï∑®ÏÜå',
                style: TextStyles.bodyMedium.copyWith(
                  color: isDarkMode
                      ? ColorPalette.textSecondaryDark
                      : ColorPalette.textSecondaryLight,
                ),
              ),
              onPressed: () {
                Navigator.of(context).pop();
              },
            ),
            ElevatedButton(
              style: ElevatedButton.styleFrom(
                backgroundColor: ColorPalette.error,
              ),
              child: const Text('Î°úÍ∑∏ÏïÑÏõÉ'),
              onPressed: () async {
                Navigator.of(context).pop();

                // Î°úÍ∑∏ÏïÑÏõÉ Ïã§Ìñâ
                await ref.read(authProvider.notifier).signOut();

                // Î°úÍ∑∏Ïù∏ ÌôîÎ©¥ÏúºÎ°ú Ïù¥Îèô (Î™®Îì† Ïù¥Ï†Ñ ÌôîÎ©¥ Ï†úÍ±∞)
                if (context.mounted) {
                  Navigator.of(context).pushNamedAndRemoveUntil(
                    LoginScreen.routeName,
                    (route) => false,
                  );
                }
              },
            ),
          ],
        );
      },
    );
  }
}

/// ÏµúÍ∑º Ï£ºÎ¨∏ ÎÇ¥Ïó≠ ÏÑπÏÖò ÏúÑÏ†Ø
class _RecentOrdersSection extends ConsumerStatefulWidget {
  final bool isDarkMode;

  const _RecentOrdersSection({required this.isDarkMode});

  @override
  ConsumerState<_RecentOrdersSection> createState() =>
      _RecentOrdersSectionState();
}

class _RecentOrdersSectionState extends ConsumerState<_RecentOrdersSection> {
  @override
  void initState() {
    super.initState();
    // ÏµúÍ∑º Ï£ºÎ¨∏ ÎÇ¥Ïó≠ Î°úÎìú
    WidgetsBinding.instance.addPostFrameCallback((_) {
      debugPrint('üè† ProfileContent: Ï£ºÎ¨∏ ÎÇ¥Ïó≠ Î°úÎìú ÏãúÏûë');
      ref.read(orderHistoryProvider.notifier).loadOrders();
    });
  }

  @override
  Widget build(BuildContext context) {
    final orderHistoryState = ref.watch(orderHistoryProvider);

    // ÎîîÎ≤ÑÍπÖÏö© Î°úÍ∑∏
    debugPrint('üè† ProfileContent: ÌòÑÏû¨ ÏÉÅÌÉú = ${orderHistoryState.status}');
    debugPrint('üè† ProfileContent: Ï£ºÎ¨∏ Í∞úÏàò = ${orderHistoryState.orders.length}');
    debugPrint('üè† ProfileContent: ÏóêÎü¨ Î©îÏãúÏßÄ = ${orderHistoryState.errorMessage}');
    debugPrint('üè† ProfileContent: hasData = ${orderHistoryState.hasData}');
    debugPrint('üè† ProfileContent: isLoading = ${orderHistoryState.isLoading}');
    debugPrint('üè† ProfileContent: hasError = ${orderHistoryState.hasError}');

    return Container(
      padding: const EdgeInsets.all(Dimensions.padding),
      decoration: BoxDecoration(
        color: widget.isDarkMode
            ? ColorPalette.surfaceDark
            : ColorPalette.surfaceLight,
        borderRadius: BorderRadius.circular(Dimensions.radius),
        boxShadow: widget.isDarkMode ? null : Styles.shadowSm,
      ),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          // ÏÑπÏÖò Ìó§Îçî
          Row(
            mainAxisAlignment: MainAxisAlignment.spaceBetween,
            children: [
              Text(
                'ÎÇòÏùò Íµ¨Îß§ÎÇ¥Ïó≠',
                style: TextStyles.titleLarge.copyWith(
                  color: widget.isDarkMode
                      ? ColorPalette.textPrimaryDark
                      : ColorPalette.textPrimaryLight,
                  fontWeight: FontWeight.bold,
                ),
              ),
              Row(
                mainAxisSize: MainAxisSize.min,
                children: [
                  // ÏÉàÎ°úÍ≥†Ïπ® Î≤ÑÌäº
                  IconButton(
                    onPressed: () {
                      debugPrint('üîÑ ÏàòÎèô Ï£ºÎ¨∏ ÎÇ¥Ïó≠ ÏÉàÎ°úÍ≥†Ïπ®');
                      ref.read(orderHistoryProvider.notifier).refreshOrders();
                    },
                    icon: Icon(
                      Icons.refresh,
                      size: 20,
                      color: widget.isDarkMode
                          ? ColorPalette.textSecondaryDark
                          : ColorPalette.textSecondaryLight,
                    ),
                    tooltip: 'ÏÉàÎ°úÍ≥†Ïπ®',
                    constraints: const BoxConstraints(
                      minWidth: 32,
                      minHeight: 32,
                    ),
                    padding: EdgeInsets.zero,
                  ),
                  const SizedBox(width: 4),
                  TextButton(
                    onPressed: () {
                      Navigator.pushNamed(context, '/order-history');
                    },
                    child: Row(
                      mainAxisSize: MainAxisSize.min,
                      children: [
                        Text(
                          'Ï£ºÎ¨∏ ÏÉÅÏÑ∏Î≥¥Í∏∞',
                          style: TextStyles.bodyMedium.copyWith(
                            color: widget.isDarkMode
                                ? ColorPalette.textSecondaryDark
                                : ColorPalette.textSecondaryLight,
                          ),
                        ),
                        const SizedBox(width: 4),
                        Icon(
                          Icons.chevron_right,
                          size: 16,
                          color: widget.isDarkMode
                              ? ColorPalette.textSecondaryDark
                              : ColorPalette.textSecondaryLight,
                        ),
                      ],
                    ),
                  ),
                ],
              ),
            ],
          ),

          const SizedBox(height: Dimensions.spacingSm),

          // Ï£ºÎ¨∏ ÎÇ¥Ïó≠ ÎÇ¥Ïö©
          _buildOrderContent(orderHistoryState),
        ],
      ),
    );
  }

  Widget _buildOrderContent(OrderHistoryState state) {
    debugPrint('üè† ÌîÑÎ°úÌïÑ - Ï£ºÎ¨∏ ÎÇ¥Ïó≠ ÏÉÅÌÉú: ${state.status}');
    debugPrint('üè† ÌîÑÎ°úÌïÑ - Ï£ºÎ¨∏ Í∞úÏàò: ${state.orders.length}');

    // ÏÉÅÌÉúÎ≥Ñ Ï£ºÎ¨∏ Í∞úÏàò ÎîîÎ≤ÑÍπÖ
    final statusCounts = <OrderStatus, int>{};
    for (final order in state.orders) {
      statusCounts[order.status] = (statusCounts[order.status] ?? 0) + 1;
    }
    debugPrint('üè† ÌîÑÎ°úÌïÑ - ÏÉÅÌÉúÎ≥Ñ Ï£ºÎ¨∏ Í∞úÏàò: $statusCounts');

    if (state.isLoading && !state.hasData) {
      return const Center(
        child: Padding(
          padding: EdgeInsets.all(Dimensions.padding),
          child: CircularProgressIndicator(),
        ),
      );
    }

    if (state.hasError && !state.hasData) {
      return Center(
        child: Padding(
          padding: const EdgeInsets.all(Dimensions.padding),
          child: Column(
            children: [
              Icon(
                Icons.error_outline,
                size: 48,
                color: ColorPalette.error,
              ),
              const SizedBox(height: Dimensions.spacingSm),
              Text(
                'Ï£ºÎ¨∏ ÎÇ¥Ïó≠ÏùÑ Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§',
                style: TextStyles.bodyMedium,
                textAlign: TextAlign.center,
              ),
              const SizedBox(height: Dimensions.spacingSm),
              ElevatedButton(
                onPressed: () =>
                    ref.read(orderHistoryProvider.notifier).refreshOrders(),
                child: const Text('Îã§Ïãú ÏãúÎèÑ'),
              ),
            ],
          ),
        ),
      );
    }

    // ÏµúÍ∑º Ï£ºÎ¨∏ 5Í∞úÎßå ÌëúÏãú
    final recentOrders = state.orders.take(5).toList();

    debugPrint('üè† ÌîÑÎ°úÌïÑ - ÌëúÏãúÌï† ÏµúÍ∑º Ï£ºÎ¨∏ Í∞úÏàò: ${recentOrders.length}');
    for (int i = 0; i < recentOrders.length; i++) {
      final order = recentOrders[i];
      debugPrint(
          'üè† Ï£ºÎ¨∏ $i: ${order.orderId} - ${order.status.displayName} - ${order.totalAmount}Ïõê');
    }

    if (recentOrders.isEmpty) {
      return _buildEmptyOrderState();
    }

    return Column(
      children: recentOrders
          .map((order) => OrderHistoryItem(
                order: order,
                onTap: () => _navigateToOrderDetail(order),
                isCompact: true,
              ))
          .toList(),
    );
  }

  Widget _buildEmptyOrderState() {
    return Padding(
      padding: const EdgeInsets.symmetric(vertical: Dimensions.spacingLg),
      child: SizedBox(
        width: double.infinity,
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          crossAxisAlignment: CrossAxisAlignment.center,
          children: [
            Icon(
              Icons.shopping_bag_outlined,
              size: 48,
              color: widget.isDarkMode
                  ? ColorPalette.textSecondaryDark
                  : ColorPalette.textSecondaryLight,
            ),
            const SizedBox(height: Dimensions.spacingSm),
            Text(
              'ÏïÑÏßÅ Ï£ºÎ¨∏ ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§',
              style: TextStyles.bodyMedium.copyWith(
                color: widget.isDarkMode
                    ? ColorPalette.textSecondaryDark
                    : ColorPalette.textSecondaryLight,
              ),
              textAlign: TextAlign.center,
            ),
            const SizedBox(height: Dimensions.spacingSm),
            TextButton(
              onPressed: () {
                // Ìôà ÌÉ≠(ÏÉÅÌíà Î™©Î°ù)ÏúºÎ°ú Ïù¥Îèô
                final homeScreenState =
                    context.findAncestorStateOfType<_HomeScreenState>();
                if (homeScreenState != null) {
                  homeScreenState._onItemTapped(0);
                }
              },
              child: Text(
                'ÏÉÅÌíà ÎëòÎü¨Î≥¥Í∏∞',
                style: TextStyles.bodySmall.copyWith(
                  color: ColorPalette.primary,
                  fontWeight: FontWeight.w600,
                ),
              ),
            ),
          ],
        ),
      ),
    );
  }

  void _navigateToOrderDetail(OrderModel order) {
    Navigator.pushNamed(
      context,
      '/order-detail',
      arguments: {'orderId': order.orderId},
    );
  }
}
